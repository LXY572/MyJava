# 文件上传
## 前情知识
1. 文件上传在企业中十分常见
2. 要想通过SpringMVC支持文件上传，需要配置一些东西！
3. 表单为了能上传文件，需要使用post方式提交，并且需要设置一个 enctype
## 代码实现
前端页面
```jsp
<%--enctype="multipart/form-data"才能支持文件上传，这个表示使用二进制流的形式处理表单数据
application/x-www-form-urlencoded 是enctype的默认值。只处理表单中value属性的值；
enctype="text/plain" ： 表示他只会将空格转换为 + 号， 其他东西不变，使用表单邮件发送
--%>
<form action="" method="post" enctype="multipart/form-data">
    <%--name服务器可以取这个文件的值--%>
    <input type="file" name="file">
    <input type="submit" value="upload">
</form>
```
问题：我们现在支持文件上传嘛？
1. 导包
```xml
        <!--文件上传和下载的包commons-fileupload，依赖于commons-io-->
        <!-- https://mvnrepository.com/artifact/commons-fileupload/commons-fileupload -->
        <dependency>
            <groupId>commons-fileupload</groupId>
            <artifactId>commons-fileupload</artifactId>
            <version>1.3.3</version>
        </dependency>
```
2. 配置文件上传的配置，需要再SpringMVC的配置文件中配置
CommonsMultipartResolver 类
MultipartResolver 实现的接口，这个是核心接口
bean的id必须为multipartResolver，否则400;
```xml
    <!--文件上传或下载-->
    <bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
        <property name="defaultEncoding" value="utf-8"/>
        <!--maxUploadSize以字节为单位 ，1,048,576‬为1M 我们这里设置上传大小限制10M-->
        <property name="maxUploadSize" value="10485760"/>
        <!--缓存大小-->
        <property name="maxInMemorySize" value="40960"/>
    </bean>
```
Controller实现
1. 必须注意：@RequestParam("file")接收文件
2. 接收的文件的类型为CommonsMultipartFile ， 这是SpringMVC封装的
```java
package com.kuang.controller;


import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.multipart.commons.CommonsMultipartFile;

import javax.servlet.http.HttpServletRequest;
import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;

@Controller
public class FileUploadController {

    @RequestMapping("/upload")
    @ResponseBody
    public String upload(@RequestParam("file") CommonsMultipartFile file, HttpServletRequest request) throws IOException {
        //1.获得文件名
        String filename = file.getOriginalFilename();
        if ("".equals(filename)){
            return "文件不存在";
        }
        //2.上传文件保存路径
        String path = request.getServletContext().getRealPath("/upload");
        File realPath = new File(path);
        if (!realPath.exists()){
            realPath.mkdir();
        }
        //3.上传文件
        InputStream is = file.getInputStream();
        FileOutputStream os = new FileOutputStream(new File(realPath, filename));

        int len = 0;
        byte[] buffer =  new byte[1024];

        while ((len=is.read(buffer))!=-1){
            os.write(buffer,0,len);
            os.flush();
        }

        //4.关闭流
        os.close();
        is.close();
        return "上传完毕";
    }

}

```







